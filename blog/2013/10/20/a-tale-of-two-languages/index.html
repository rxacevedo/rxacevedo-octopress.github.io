
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A Tale of Two Languages - Roberto Acevedo</title>
  <meta name="author" content="Roberto Acevedo">

  
  <meta name="description" content="I&rsquo;m fortunate enough to be part of a team at work that is researching a new JVM language for us to potentially move to in the future. Since it& &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rxacevedo.github.io/blog/2013/10/20/a-tale-of-two-languages">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Roberto Acevedo" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Roberto Acevedo</a></h1>
  
    <h2>Navel-gazing</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rxacevedo.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Tale of Two Languages</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-20T10:51:00-04:00" pubdate data-updated="true">Oct 20<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;m fortunate enough to be part of a team at work that is researching a new JVM language for us to potentially move to in the future. Since it&rsquo;s fun for me, I figured I may as well document the process.</p>

<p>We&rsquo;re a Java shop with developers of varying skill levels, but there hasn&rsquo;t much concentration in other
languages or paradigms. Many of those on my team have been
writing OOP for the past 5-10 years, so I am excited to see how the
transition from the <a href="http://docs.spring.io/spring/docs/2.0.x/api/org/springframework/orm/jdo/TransactionAwarePersistenceManagerFactoryProxy.html">Java way</a>
where every behavior is coupled with an object, to a more
behavior-oriented approach (myself included, as I did not know Java or have any professional experience as a programmer when I started). The two languages that we&rsquo;ve opted to look
into are <a href="http://www.scala-lang.org/">Scala</a> and
<a href="http://clojure.org/">Clojure</a>.</p>

<p>The main reason for to even consider adopting a new language is, most importantly, to enable developers to approach concurrent development. As Martin Odersky says, &ldquo;the flood is rising.&rdquo;</p>

<p>As an example, I opted for a tree-recursive algorithm, to see how each language would handle it. If you&rsquo;ve taken the Functional Programming in Scala course on Coursera, you will recognize this problem:</p>

<figure class='code'><figcaption><span>Counting change in Java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Change</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">amt</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">denoms</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="n">denoms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="n">denoms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
</span><span class='line'>    <span class="n">denoms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
</span><span class='line'>    <span class="n">denoms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
</span><span class='line'>    <span class="n">denoms</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">ways</span> <span class="o">=</span> <span class="n">countChange</span><span class="o">(</span><span class="n">amt</span><span class="o">,</span> <span class="n">denoms</span><span class="o">);</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">finish</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Amount: &quot;</span> <span class="o">+</span> <span class="n">amt</span> <span class="o">+</span> <span class="s">&quot;\nWays to make change: &quot;</span> <span class="o">+</span> <span class="n">ways</span> <span class="o">+</span> <span class="s">&quot;\nTime: &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="o">));</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">countChange</span><span class="o">(</span><span class="kt">int</span> <span class="n">amt</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">denoms</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">amt</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">amt</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">denoms</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nf">countChange</span><span class="o">(</span><span class="n">amt</span> <span class="o">-</span> <span class="n">denoms</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="n">denoms</span><span class="o">)</span> <span class="o">+</span> <span class="n">countChange</span><span class="o">(</span><span class="n">amt</span><span class="o">,</span> <span class="n">denoms</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">denoms</span><span class="o">.</span><span class="na">size</span><span class="o">()));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The same logic implemented in Scala looks like this:</p>

<figure class='code'><figcaption><span>Counting change in Scala</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">scala.compat.Platform</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">Change</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">amt</span> <span class="k">=</span> <span class="n">args</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">toInt</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">start</span> <span class="k">=</span> <span class="nc">Platform</span><span class="o">.</span><span class="n">currentTime</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">ways</span> <span class="k">=</span> <span class="n">countChange</span><span class="o">(</span><span class="n">amt</span><span class="o">,</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">50</span><span class="o">))</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">finish</span> <span class="k">=</span> <span class="nc">Platform</span><span class="o">.</span><span class="n">currentTime</span>
</span><span class='line'>    <span class="n">println</span><span class="o">(</span><span class="s">&quot;Amount: &quot;</span> <span class="o">+</span> <span class="n">amt</span> <span class="o">+</span> <span class="s">&quot;\nWays to make change: &quot;</span> <span class="o">+</span> <span class="n">ways</span> <span class="o">+</span> <span class="s">&quot;\nTime: &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="o">))</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">countChange</span><span class="o">(</span><span class="n">amt</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">denoms</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">amt</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>  <span class="mi">1</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">amt</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">denoms</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">else</span> <span class="n">countChange</span><span class="o">(</span><span class="n">amt</span><span class="o">,</span> <span class="n">denoms</span><span class="o">.</span><span class="n">tail</span><span class="o">)</span> <span class="o">+</span> <span class="n">countChange</span><span class="o">(</span><span class="n">amt</span> <span class="o">-</span> <span class="n">denoms</span><span class="o">.</span><span class="n">head</span><span class="o">,</span> <span class="n">denoms</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And finally, Clojure:</p>

<figure class='code'><figcaption><span>Counting change in Clojure</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">change.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:gen-class</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">count-change</span> <span class="p">[</span><span class="nv">amt</span> <span class="nv">denoms</span><span class="p">]</span>
</span><span class='line'><span class="s">&quot;Returns the number of ways to make change for a given amount using a tree-recursive process&quot;</span>
</span><span class='line'><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span> <span class="p">(</span><span class="k">fn </span><span class="nv">inner</span> <span class="p">[</span><span class="nv">amt</span> <span class="nv">denoms</span><span class="p">]</span>
</span><span class='line'>           <span class="p">(</span><span class="nb">cond </span><span class="p">(</span><span class="nb">zero? </span><span class="nv">amt</span><span class="p">)</span> <span class="mi">1</span>
</span><span class='line'>                 <span class="p">(</span><span class="nb">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amt</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">nil</span> <span class="p">(</span><span class="nb">seq </span><span class="nv">denoms</span><span class="p">)))</span> <span class="mi">0</span>
</span><span class='line'>                 <span class="ss">:else</span> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">less-amt</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amt</span> <span class="p">(</span><span class="nb">first </span><span class="nv">denoms</span><span class="p">))</span>
</span><span class='line'>                             <span class="nv">less-denoms</span> <span class="p">(</span><span class="nb">rest </span><span class="nv">denoms</span><span class="p">)]</span>
</span><span class='line'>                         <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">inner</span> <span class="nv">amt</span> <span class="nv">less-denoms</span><span class="p">)</span>
</span><span class='line'>                            <span class="p">(</span><span class="nf">inner</span> <span class="nv">less-amt</span> <span class="nv">denoms</span><span class="p">)))))]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">f</span> <span class="nv">amt</span> <span class="nv">denoms</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span>
</span><span class='line'>  <span class="s">&quot;I don&#39;t do a whole lot ... yet.&quot;</span>
</span><span class='line'>  <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">time </span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">amt</span> <span class="p">(</span><span class="nf">read-string</span> <span class="p">(</span><span class="nb">first </span><span class="nv">args</span><span class="p">))</span>
</span><span class='line'>              <span class="nv">ways</span> <span class="p">(</span><span class="nf">count-change</span> <span class="nv">amt</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">5</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">50</span><span class="p">])]</span>
</span><span class='line'>          <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="s">&quot;Amount: &quot;</span> <span class="nv">amt</span> <span class="s">&quot;\nWays: &quot;</span> <span class="nv">ways</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>So how long does this process take to run for each implementation? Here are the compilations (first JDK Version):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>java version <span class="s2">&quot;1.7.0_25&quot;</span>
</span><span class='line'>Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 1.7.0_25-b15<span class="o">)</span>
</span><span class='line'>Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 23.25-b01, mixed mode<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Scala:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>scalac Change.scala <span class="o">&amp;&amp;</span> <span class="k">for </span>i in <span class="k">$(</span>cat sizes.txt<span class="k">)</span>; <span class="k">do </span>scala Change <span class="nv">$i</span>; <span class="k">done</span>
</span><span class='line'><span class="c"># Note - Scala passess -Xmx256M -Xms32M to Java, so I did the same for the other two</span>
</span></code></pre></td></tr></table></div></figure>


<p>Java:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>javac Change.java <span class="o">&amp;&amp;</span> <span class="k">for </span>i in <span class="k">$(</span>cat sizes.txt<span class="k">)</span>; <span class="k">do </span>java -Xmx256M -Xms32M Change <span class="nv">$i</span>; <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>Clojure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>java -cp src/:/usr/local/Cellar/clojure/1.5.1/clojure-1.5.1.jar -Dclojure.compile.path<span class="o">=</span>classes clojure.lang.Compile change.core
</span><span class='line'>Compiling change.core to classes
</span><span class='line'><span class="k">for </span>i in <span class="k">$(</span>cat sizes.txt<span class="k">)</span>; <span class="k">do </span>java -Xmx256M -Xms32M -cp classes/:/usr/local/Cellar/clojure/1.5.1/clojure-1.5.1.jar change.core <span class="nv">$i</span>; <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the results (in milliseconds):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># Java
</span><span class='line'>Amount: 128
</span><span class='line'>Ways to make change: 658
</span><span class='line'>Time: 14
</span><span class='line'>Amount: 256
</span><span class='line'>Ways to make change: 6630
</span><span class='line'>Time: 25
</span><span class='line'>Amount: 512
</span><span class='line'>Ways to make change: 78694
</span><span class='line'>Time: 162
</span><span class='line'>Amount: 1024
</span><span class='line'>Ways to make change: 1070685
</span><span class='line'>Time: 3083
</span><span class='line'>Amount: 2048
</span><span class='line'>Ways to make change: 15894424
</span><span class='line'>Time: 80155
</span><span class='line'>Amount: 4096
</span><span class='line'>Ways to make change: 244782054
</span><span class='line'>Time: 2860846
</span><span class='line'>
</span><span class='line'># Scala
</span><span class='line'>Amount: 128
</span><span class='line'>Ways to make change: 658
</span><span class='line'>Time: 12
</span><span class='line'>Amount: 256
</span><span class='line'>Ways to make change: 6630
</span><span class='line'>Time: 16
</span><span class='line'>Amount: 512
</span><span class='line'>Ways to make change: 78694
</span><span class='line'>Time: 89
</span><span class='line'>Amount: 1024
</span><span class='line'>Ways to make change: 1070685
</span><span class='line'>Time: 1777
</span><span class='line'>Amount: 2048
</span><span class='line'>Ways to make change: 15894424
</span><span class='line'>Time: 46779
</span><span class='line'>Amount: 4096
</span><span class='line'>Ways to make change: 244782054
</span><span class='line'>Time: 1422710
</span><span class='line'>
</span><span class='line'># Clojure
</span><span class='line'>Amount: 128
</span><span class='line'>Ways: 658
</span><span class='line'>&quot;Elapsed time: 104.863 msecs&quot;
</span><span class='line'>Amount: 256
</span><span class='line'>Ways: 6630
</span><span class='line'>&quot;Elapsed time: 124.266 msecs&quot;
</span><span class='line'>Amount: 512
</span><span class='line'>Ways: 78694
</span><span class='line'>&quot;Elapsed time: 561.276 msecs&quot;
</span><span class='line'>Amount: 1024
</span><span class='line'>Ways: 1070685
</span><span class='line'>&quot;Elapsed time: 9900.2 msecs&quot;
</span><span class='line'>Amount: 2048
</span><span class='line'>Ways: 15894424
</span><span class='line'>&quot;Elapsed time: 258364.033 msecs&quot;
</span><span class='line'># I got tired of waiting for it to compute the answer for 4096, I&#39;ll just call it &quot;a long long time&quot;
</span></code></pre></td></tr></table></div></figure>


<p>Scala is 2x as fast as Java, Clojure is 3.2x slower than Java and 5.5x slower than Scala (for this problem), ouch! Maybe the bytecode will shed some light on things:</p>

<figure class='code'><figcaption><span>Java bytecode</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>  public static int countChange(int, java.util.List&lt;java.lang.Integer&gt;);
</span><span class='line'>    Signature: (ILjava/util/List;)I
</span><span class='line'>    flags: ACC_PUBLIC, ACC_STATIC
</span><span class='line'>    Code:
</span><span class='line'>      stack=5, locals=2, args_size=2
</span><span class='line'>         0: iload_0
</span><span class='line'>         1: ifne          6
</span><span class='line'>         4: iconst_1
</span><span class='line'>         5: ireturn
</span><span class='line'>         6: iload_0
</span><span class='line'>         7: iflt          19
</span><span class='line'>        10: aload_1
</span><span class='line'>        11: invokeinterface #20,  1           // InterfaceMethod java/util/List.size:()I
</span><span class='line'>        16: ifne          21
</span><span class='line'>        19: iconst_0
</span><span class='line'>        20: ireturn
</span><span class='line'>        21: iload_0
</span><span class='line'>        22: aload_1
</span><span class='line'>        23: iconst_0
</span><span class='line'>        24: invokeinterface #21,  2           // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;
</span><span class='line'>        29: checkcast     #22                 // class java/lang/Integer
</span><span class='line'>        32: invokevirtual #23                 // Method java/lang/Integer.intValue:()I
</span><span class='line'>        35: isub
</span><span class='line'>        36: aload_1
</span><span class='line'>        37: invokestatic  #8                  // Method countChange:(ILjava/util/List;)I
</span><span class='line'>        40: iload_0
</span><span class='line'>        41: aload_1
</span><span class='line'>        42: iconst_1
</span><span class='line'>        43: aload_1
</span><span class='line'>        44: invokeinterface #20,  1           // InterfaceMethod java/util/List.size:()I
</span><span class='line'>        49: invokeinterface #24,  3           // InterfaceMethod java/util/List.subList:(II)Ljava/util/List;
</span><span class='line'>        54: invokestatic  #8                  // Method countChange:(ILjava/util/List;)I
</span><span class='line'>        57: iadd
</span><span class='line'>        58: ireturn
</span><span class='line'>      LineNumberTable:
</span><span class='line'>        line 21: 0
</span><span class='line'>        line 22: 4
</span><span class='line'>        line 23: 6
</span><span class='line'>        line 24: 19
</span><span class='line'>        line 26: 21
</span><span class='line'>      StackMapTable: number_of_entries = 3
</span><span class='line'>           frame_type = 6 /* same */
</span><span class='line'>           frame_type = 12 /* same */
</span><span class='line'>           frame_type = 1 /* same */
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Scala bytecode</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'> public int countChange(int, scala.collection.immutable.List&lt;java.lang.Object&gt;);
</span><span class='line'>    Signature: (ILscala/collection/immutable/List;)I
</span><span class='line'>    flags: ACC_PUBLIC
</span><span class='line'>    Code:
</span><span class='line'>      stack=4, locals=3, args_size=3
</span><span class='line'>         0: iload_1
</span><span class='line'>         1: iconst_0
</span><span class='line'>         2: if_icmpne     9
</span><span class='line'>         5: iconst_1
</span><span class='line'>         6: goto          53
</span><span class='line'>         9: iload_1
</span><span class='line'>        10: iconst_0
</span><span class='line'>        11: if_icmplt     22
</span><span class='line'>        14: aload_2
</span><span class='line'>        15: invokevirtual #117                // Method scala/collection/immutable/List.length:()I
</span><span class='line'>        18: iconst_0
</span><span class='line'>        19: if_icmpne     26
</span><span class='line'>        22: iconst_0
</span><span class='line'>        23: goto          53
</span><span class='line'>        26: aload_0
</span><span class='line'>        27: iload_1
</span><span class='line'>        28: aload_2
</span><span class='line'>        29: invokevirtual #120                // Method scala/collection/immutable/List.tail:()Ljava/lang/Object;
</span><span class='line'>        32: checkcast     #114                // class scala/collection/immutable/List
</span><span class='line'>        35: invokevirtual #72                 // Method countChange:(ILscala/collection/immutable/List;)I
</span><span class='line'>        38: aload_0
</span><span class='line'>        39: iload_1
</span><span class='line'>        40: aload_2
</span><span class='line'>        41: invokevirtual #121                // Method scala/collection/immutable/List.head:()Ljava/lang/Object;
</span><span class='line'>        44: invokestatic  #125                // Method scala/runtime/BoxesRunTime.unboxToInt:(Ljava/lang/Object;)I
</span><span class='line'>        47: isub
</span><span class='line'>        48: aload_2
</span><span class='line'>        49: invokevirtual #72                 // Method countChange:(ILscala/collection/immutable/List;)I
</span><span class='line'>        52: iadd
</span><span class='line'>        53: ireturn
</span><span class='line'>      LocalVariableTable:
</span><span class='line'>        Start  Length  Slot  Name   Signature
</span><span class='line'>               0      54     0  this   LChange$;
</span><span class='line'>               0      54     1   amt   I
</span><span class='line'>               0      54     2 denoms   Lscala/collection/immutable/List;
</span><span class='line'>      LineNumberTable:
</span><span class='line'>        line 14: 0
</span><span class='line'>        line 15: 9
</span><span class='line'>        line 16: 26
</span><span class='line'>        line 14: 53
</span><span class='line'>      StackMapTable: number_of_entries = 4
</span><span class='line'>           frame_type = 9 /* same */
</span><span class='line'>           frame_type = 12 /* same */
</span><span class='line'>           frame_type = 3 /* same */
</span><span class='line'>           frame_type = 90 /* same_locals_1_stack_item */
</span><span class='line'>          stack = [ int ]
</span></code></pre></td></tr></table></div></figure>


<p>In Clojure, anonymous functions are compiled into their own class files, so I guess I should include the entire <code>javap</code> output for the fn I defined (inner):</p>

<figure class='code'><figcaption><span>Clojure bytecode</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Compiled from &quot;core.clj&quot;
</span><span class='line'>public final class change.core$count_change$inner__4 extends clojure.lang.AFunction {
</span><span class='line'>  public static final clojure.lang.Var const__0;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static final java.lang.Object const__1;
</span><span class='line'>    Signature: Ljava/lang/Object;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Var const__2;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static final java.lang.Object const__3;
</span><span class='line'>    Signature: Ljava/lang/Object;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Var const__4;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Var const__5;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Keyword const__6;
</span><span class='line'>    Signature: Lclojure/lang/Keyword;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Var const__7;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Var const__8;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Var const__9;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static final clojure.lang.Var const__10;
</span><span class='line'>    Signature: Lclojure/lang/Var;
</span><span class='line'>
</span><span class='line'>  public static {};
</span><span class='line'>    Signature: ()V
</span><span class='line'>    Code:
</span><span class='line'>       0: ldc           #23                 // String clojure.core
</span><span class='line'>       2: ldc           #25                 // String zero?
</span><span class='line'>       4: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>       7: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>      10: putstatic     #35                 // Field const__0:Lclojure/lang/Var;
</span><span class='line'>      13: lconst_1
</span><span class='line'>      14: invokestatic  #41                 // Method java/lang/Long.valueOf:(J)Ljava/lang/Long;
</span><span class='line'>      17: putstatic     #43                 // Field const__1:Ljava/lang/Object;
</span><span class='line'>      20: ldc           #23                 // String clojure.core
</span><span class='line'>      22: ldc           #45                 // String &lt;
</span><span class='line'>      24: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>      27: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>      30: putstatic     #47                 // Field const__2:Lclojure/lang/Var;
</span><span class='line'>      33: lconst_0
</span><span class='line'>      34: invokestatic  #41                 // Method java/lang/Long.valueOf:(J)Ljava/lang/Long;
</span><span class='line'>      37: putstatic     #49                 // Field const__3:Ljava/lang/Object;
</span><span class='line'>      40: ldc           #23                 // String clojure.core
</span><span class='line'>      42: ldc           #51                 // String =
</span><span class='line'>      44: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>      47: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>      50: putstatic     #53                 // Field const__4:Lclojure/lang/Var;
</span><span class='line'>      53: ldc           #23                 // String clojure.core
</span><span class='line'>      55: ldc           #55                 // String seq
</span><span class='line'>      57: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>      60: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>      63: putstatic     #57                 // Field const__5:Lclojure/lang/Var;
</span><span class='line'>      66: aconst_null
</span><span class='line'>      67: ldc           #59                 // String else
</span><span class='line'>      69: invokestatic  #63                 // Method clojure/lang/RT.keyword:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Keyword;
</span><span class='line'>      72: checkcast     #65                 // class clojure/lang/Keyword
</span><span class='line'>      75: putstatic     #67                 // Field const__6:Lclojure/lang/Keyword;
</span><span class='line'>      78: ldc           #23                 // String clojure.core
</span><span class='line'>      80: ldc           #69                 // String -
</span><span class='line'>      82: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>      85: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>      88: putstatic     #71                 // Field const__7:Lclojure/lang/Var;
</span><span class='line'>      91: ldc           #23                 // String clojure.core
</span><span class='line'>      93: ldc           #73                 // String first
</span><span class='line'>      95: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>      98: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>     101: putstatic     #75                 // Field const__8:Lclojure/lang/Var;
</span><span class='line'>     104: ldc           #23                 // String clojure.core
</span><span class='line'>     106: ldc           #77                 // String rest
</span><span class='line'>     108: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>     111: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>     114: putstatic     #79                 // Field const__9:Lclojure/lang/Var;
</span><span class='line'>     117: ldc           #23                 // String clojure.core
</span><span class='line'>     119: ldc           #81                 // String +
</span><span class='line'>     121: invokestatic  #31                 // Method clojure/lang/RT.var:(Ljava/lang/String;Ljava/lang/String;)Lclojure/lang/Var;
</span><span class='line'>     124: checkcast     #33                 // class clojure/lang/Var
</span><span class='line'>     127: putstatic     #83                 // Field const__10:Lclojure/lang/Var;
</span><span class='line'>     130: return
</span><span class='line'>
</span><span class='line'>  public change.core$count_change$inner__4();
</span><span class='line'>    Signature: ()V
</span><span class='line'>    Code:
</span><span class='line'>       0: aload_0
</span><span class='line'>       1: invokespecial #86                 // Method clojure/lang/AFunction.&quot;&lt;init&gt;&quot;:()V
</span><span class='line'>       4: return
</span><span class='line'>
</span><span class='line'>  public java.lang.Object invoke(java.lang.Object, java.lang.Object);
</span><span class='line'>    Signature: (Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
</span><span class='line'>    Code:
</span><span class='line'>       0: aload_1
</span><span class='line'>       1: invokestatic  #94                 // Method clojure/lang/Numbers.isZero:(Ljava/lang/Object;)Z
</span><span class='line'>       4: ifeq          14
</span><span class='line'>       7: getstatic     #43                 // Field const__1:Ljava/lang/Object;
</span><span class='line'>      10: goto          148
</span><span class='line'>      13: pop
</span><span class='line'>      14: aload_1
</span><span class='line'>      15: lconst_0
</span><span class='line'>      16: invokestatic  #98                 // Method clojure/lang/Numbers.lt:(Ljava/lang/Object;J)Z
</span><span class='line'>      19: istore_3
</span><span class='line'>      20: iload_3
</span><span class='line'>      21: ifeq          29
</span><span class='line'>      24: iload_3
</span><span class='line'>      25: goto          48
</span><span class='line'>      28: pop
</span><span class='line'>      29: aconst_null
</span><span class='line'>      30: getstatic     #57                 // Field const__5:Lclojure/lang/Var;
</span><span class='line'>      33: invokevirtual #102                // Method clojure/lang/Var.getRawRoot:()Ljava/lang/Object;
</span><span class='line'>      36: checkcast     #104                // class clojure/lang/IFn
</span><span class='line'>      39: aload_2
</span><span class='line'>      40: invokeinterface #107,  2          // InterfaceMethod clojure/lang/IFn.invoke:(Ljava/lang/Object;)Ljava/lang/Object;
</span><span class='line'>      45: invokestatic  #113                // Method clojure/lang/Util.equiv:(Ljava/lang/Object;Ljava/lang/Object;)Z
</span><span class='line'>      48: ifeq          58
</span><span class='line'>      51: getstatic     #49                 // Field const__3:Ljava/lang/Object;
</span><span class='line'>      54: goto          148
</span><span class='line'>      57: pop
</span><span class='line'>      58: getstatic     #67                 // Field const__6:Lclojure/lang/Keyword;
</span><span class='line'>      61: dup
</span><span class='line'>      62: ifnull        146
</span><span class='line'>      65: getstatic     #121                // Field java/lang/Boolean.FALSE:Ljava/lang/Boolean;
</span><span class='line'>      68: if_acmpeq     147
</span><span class='line'>      71: aload_1
</span><span class='line'>      72: getstatic     #75                 // Field const__8:Lclojure/lang/Var;
</span><span class='line'>      75: invokevirtual #102                // Method clojure/lang/Var.getRawRoot:()Ljava/lang/Object;
</span><span class='line'>      78: checkcast     #104                // class clojure/lang/IFn
</span><span class='line'>      81: aload_2
</span><span class='line'>      82: invokeinterface #107,  2          // InterfaceMethod clojure/lang/IFn.invoke:(Ljava/lang/Object;)Ljava/lang/Object;
</span><span class='line'>      87: invokestatic  #125                // Method clojure/lang/Numbers.minus:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Number;
</span><span class='line'>      90: astore_3
</span><span class='line'>      91: getstatic     #79                 // Field const__9:Lclojure/lang/Var;
</span><span class='line'>      94: invokevirtual #102                // Method clojure/lang/Var.getRawRoot:()Ljava/lang/Object;
</span><span class='line'>      97: checkcast     #104                // class clojure/lang/IFn
</span><span class='line'>     100: aload_2
</span><span class='line'>     101: invokeinterface #107,  2          // InterfaceMethod clojure/lang/IFn.invoke:(Ljava/lang/Object;)Ljava/lang/Object;
</span><span class='line'>     106: astore        4
</span><span class='line'>     108: aload_0
</span><span class='line'>     109: checkcast     #104                // class clojure/lang/IFn
</span><span class='line'>     112: aload_1
</span><span class='line'>     113: aconst_null
</span><span class='line'>     114: astore_1
</span><span class='line'>     115: aload         4
</span><span class='line'>     117: aconst_null
</span><span class='line'>     118: astore        4
</span><span class='line'>     120: invokeinterface #127,  3          // InterfaceMethod clojure/lang/IFn.invoke:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
</span><span class='line'>     125: aload_0
</span><span class='line'>     126: checkcast     #104                // class clojure/lang/IFn
</span><span class='line'>     129: aload_3
</span><span class='line'>     130: aconst_null
</span><span class='line'>     131: astore_3
</span><span class='line'>     132: aload_2
</span><span class='line'>     133: aconst_null
</span><span class='line'>     134: astore_2
</span><span class='line'>     135: invokeinterface #127,  3          // InterfaceMethod clojure/lang/IFn.invoke:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
</span><span class='line'>     140: invokestatic  #130                // Method clojure/lang/Numbers.add:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Number;
</span><span class='line'>     143: goto          148
</span><span class='line'>     146: pop
</span><span class='line'>     147: aconst_null
</span><span class='line'>     148: areturn
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Holy stromboli! Looks like Clojure generates a lot more bytecode.</p>

<p> There&rsquo;s nothing exciting going on in either the Java or Scala bytecode, both make two calls to countChange, they use slightly different instructions when doing the comparisons in the if-else, but that is the most noticeable difference. I thought that maybe the Scala compiler had done something neat to optimize the recursive call, but that seems not to be the case. Scala can optimize for tail-recursive calls by converting them to loops (goto statement at the end of the instruction sequence which jumps to offset 0), but not for this type of algorithm. I am left wondering what magic is taking place to account for the vast difference in performance.</p>

<p>Some thoughts:</p>

<ul>
<li>I could have used an array in Java instead of an ArrayList in the first example, but I did not feel like this would be the way most developers would approach the problem.</li>
<li>Clojure is a dynamic language (which explains the slowness) and I did not provide type hints because, again, that is not &ldquo;idiomatic Clojure.&rdquo;</li>
<li>Clojure is &lsquo;slow&rsquo;, but the syntax woos me, so I will probably learn it anyways.</li>
<li>All of these languages run on the same ol&#8217; JVM, so one can think of this as comparing &ldquo;effort it takes to write the code&rdquo; vs. how performant it is.</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Roberto Acevedo</span></span>

      








  


<time datetime="2013-10-20T10:51:00-04:00" pubdate data-updated="true">Oct 20<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/clojure/'>clojure</a>, <a class='category' href='/blog/categories/java/'>java</a>, <a class='category' href='/blog/categories/programming/'>programming</a>, <a class='category' href='/blog/categories/scala/'>scala</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rxacevedo.github.io/blog/2013/10/20/a-tale-of-two-languages/" data-via="rxacevedo" data-counturl="http://rxacevedo.github.io/blog/2013/10/20/a-tale-of-two-languages/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/04/08/recursion-in-scala/" title="Previous Post: Recursion in Scala">&laquo; Recursion in Scala</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/12/18/scala-and-clojure-list-operations/" title="Next Post: Scala and Clojure List Operations">Scala and Clojure List Operations &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>A little something about me.</p>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/rxacevedo">@rxacevedo</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rxacevedo',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Roberto Acevedo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
